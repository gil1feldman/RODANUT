<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>רודנות בחסות החוק - תיעוד</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      padding: 20px;
    }
    .highlight {
      color: red;
      font-weight: bold;
    }
    .preview {
      margin-top: 30px;
      border-top: 2px solid #ccc;
      padding-top: 20px;
    }
    img {
      max-width: 400px;
      display: block;
      margin-top: 20px;
    }
    .banner {
      width: 100%;
      max-width: 800px;
      margin-bottom: 20px;
    }
    #canvasContainer {
      display: none;
    }
  </style>
</head>
<body>
  <img class="banner" src="https://raw.githubusercontent.com/gil1feldman/RODANUT/main/%D7%A8%D7%95%D7%93%D7%A0%D7%95%D7%AA_%D7%91%D7%90%D7%A0%D7%A8_%D7%A6%D7%A8.png" alt="באנר רודנות">
  <h1>רודנות בחסות החוק - תיעוד</h1>
  <form id="messageForm">
    <h3>סמן את הנקודות הרלוונטיות:</h3>
    <div id="checkboxes"></div>
    <br>
    <label>הדבק תמונה: <input type="file" id="imageInput" accept="image/*"></label>
    <br><br>
    <button type="button" onclick="generatePreview()">צור</button>
    <button type="button" onclick="downloadImage()">הורד כתמונה</button>
  </form>

  <div class="preview" id="previewSection"></div>
  <div id="canvasContainer"><canvas id="outputCanvas"></canvas></div>

  <script>
    const points = [
      "ניצחון של המנהיג בבחירות דמוקרטיות",
      "פירוק המנגנונים המגבילים את הרשות המבצעת",
      "השתלטות על בית הנבחרים או הפיכת מוסד זה לבלתי רלוונטי",
      "הכפפת בתי המשפט לרשות המבצעת - על ידי 'רפורמות' ומינוי נאמנים",
      "הצבת נאמנים בתפקידי מפתח - (התובע הכללי, ועדת הבחירות המרכזית, הוועדה לבחירת שופטים וכדומה)",
      "שינוי המפה התקשורתית, כך שכלי תקשורת ישמשו תיבת תהודה למסרי הממשלה",
      "דה-לגיטימציה והגבלת פעילות של ארגוני חברה אזרחית ומפלגות האופוזיציה",
      "שינוי חוקי הבחירות באופן שמבטיח ניצחון בבחירות עתידיות"
    ];

    const checkboxContainer = document.getElementById("checkboxes");
    points.forEach((point, index) => {
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.id = "point" + index;
      checkbox.value = index;
      const label = document.createElement("label");
      label.htmlFor = checkbox.id;
      label.textContent = (index + 1) + ". " + point;
      checkboxContainer.appendChild(checkbox);
      checkboxContainer.appendChild(label);
      checkboxContainer.appendChild(document.createElement("br"));
    });

    let uploadedImage = null;

    document.getElementById("imageInput").addEventListener("change", function(e) {
      const reader = new FileReader();
      reader.onload = function (e) {
        uploadedImage = new Image();
        uploadedImage.src = e.target.result;
      };
      reader.readAsDataURL(this.files[0]);
    });

    function generatePreview() {
  const preview = document.getElementById("previewSection");
  preview.innerHTML = "";

  // Add banner image
  const bannerImg = document.createElement("img");
  bannerImg.src = "https://raw.githubusercontent.com/gil1feldman/RODANUT/main/%D7%A8%D7%95%D7%93%D7%A0%D7%95%D7%AA_%D7%91%D7%90%D7%A0%D7%A8_%D7%A6%D7%A8.png";
  bannerImg.className = "banner";
  preview.appendChild(bannerImg);

  const selected = Array.from(document.querySelectorAll("input[type='checkbox']"))
    .map((cb, i) => cb.checked);

  const list = document.createElement("ul");
  points.forEach((point, i) => {
    const item = document.createElement("li");
    item.innerHTML = selected[i] ? `<span class='highlight'>${point}</span>` : point;
    list.appendChild(item);
  });

  preview.appendChild(list);
  if (uploadedImage) {
    const img = document.createElement("img");
    img.src = uploadedImage.src;
    img.style.margin = "20px auto";
    img.style.display = "block";
    preview.appendChild(img);
  }
}</span>` : point;
        list.appendChild(item);
      });

      preview.appendChild(list);
      if (uploadedImage) {
        const img = document.createElement("img");
        img.src = uploadedImage.src;
        preview.appendChild(img);
      }
    }

    function downloadImage() {
      const canvas = document.getElementById("outputCanvas");
      const ctx = canvas.getContext("2d");
      const selected = Array.from(document.querySelectorAll("input[type='checkbox']"))
        .map((cb, i) => cb.checked);

      const banner = new Image();
      banner.crossOrigin = "anonymous";
      banner.src = "https://raw.githubusercontent.com/gil1feldman/RODANUT/main/%D7%A8%D7%95%D7%93%D7%A0%D7%95%D7%AA_%D7%91%D7%90%D7%A0%D7%A8_%D7%A6%D7%A8.png";

      banner.onload = function () {
        const width = 800;
        const lineHeight = 30;
        const margin = 20;
        const baseHeight = (points.length * lineHeight) + (uploadedImage ? 400 : 0) + banner.height + 3 * margin;

        canvas.width = width;
        canvas.height = baseHeight;

        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.drawImage(banner, 0, 0, width, banner.height);

        ctx.fillStyle = "black";
        ctx.font = "20px Arial";

        points.forEach((point, i) => {
          const y = banner.height + margin + i * lineHeight;
          ctx.fillStyle = selected[i] ? "red" : "black";
          ctx.fillText((i + 1) + ". " + point, margin, y);
        });

        if (uploadedImage) {
          uploadedImage.onload = () => {
            ctx.drawImage(uploadedImage, 0, banner.height + margin + points.length * lineHeight + margin, 400, 300);
            saveCanvas();
          };
          if (uploadedImage.complete) {
            ctx.drawImage(uploadedImage, 0, banner.height + margin + points.length * lineHeight + margin, 400, 300);
            saveCanvas();
          }
        } else {
          saveCanvas();
        }
      };
    }

    function saveCanvas() {
      const canvas = document.getElementById("outputCanvas");
      const link = document.createElement('a');
      link.download = 'message.png';
      link.href = canvas.toDataURL();
      link.click();
    }
  </script>
</body>
</html>
